"use strict";
/**
 * @file
 * @module jfseb.mgnlq_model.breakdown
 * @copyright (c) 2016 Gerd Forstmann
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.breakdownString = exports.makeMatchPattern = exports.tokenizeString = exports.combineTokens = exports.isCombinableRangeReturnIndex = exports.isCombinableSplit = exports.swallowWord = exports.swallowQuote = exports.countSpaces = exports.isQuoted = exports.recombineQuoted = exports.trimQuotedSpaced = exports.trimQuoted = exports.cleanseQuotedString = exports.cleanseStringLeaveDots = exports.cleanseString = void 0;
const debug = require("debug");
const debuglog = debug('breakdown');
function cleanseString(sString) {
    var len = 0;
    while (len !== sString.length) {
        len = sString.length;
        sString = sString.replace(/\s+/g, ' ');
        sString = sString.replace(/^\s+/, '');
        sString = sString.replace(/\s+$/, '');
        sString = sString.replace(/^[,;.]+/, '');
        sString = sString.replace(/[,;.]+$/, '');
    }
    return sString;
}
exports.cleanseString = cleanseString;
function cleanseStringLeaveDots(sString) {
    var len = 0;
    while (len !== sString.length) {
        len = sString.length;
        sString = sString.replace(/\s+/g, ' ');
        sString = sString.replace(/^\s+/, '');
        sString = sString.replace(/\s+$/, '');
        sString = sString.replace(/^[,;!?]+/, '');
        sString = sString.replace(/[,;!?]+$/, '');
    }
    return sString;
}
exports.cleanseStringLeaveDots = cleanseStringLeaveDots;
function cleanseQuotedString(sString) {
    var len = 0;
    while (len !== sString.length) {
        len = sString.length;
        sString = sString.replace(/\s\s+/g, ' ');
        sString = sString.replace(/\s+/g, ' ');
        sString = sString.replace(/^\s+/, '');
        sString = sString.replace(/\s+$/, '');
        sString = sString.replace(/^[,;.]+/, '');
        sString = sString.replace(/[,;.]+$/, '');
    }
    return sString;
}
exports.cleanseQuotedString = cleanseQuotedString;
const regexpRemoveDouble = new RegExp(/^\"(\".*\")\"$/);
const striptail = new RegExp(/^\"([^\"]+)"$/);
function trimQuoted(sString) {
    var skipUntil = 0;
    var stripped = sString;
    var m = regexpRemoveDouble.exec(sString);
    while (m) {
        stripped = m[1];
        m = regexpRemoveDouble.exec(stripped);
    }
    debuglog("stripped " + stripped);
    m = striptail.exec(stripped);
    if (m) {
        return m[1];
    }
    return cleanseString(sString);
}
exports.trimQuoted = trimQuoted;
function trimQuotedSpaced(sString) {
    var skipUntil = 0;
    sString = sString.replace(/^"\s+/g, '"');
    sString = sString.replace(/\s+\"$/g, '"');
    return sString;
}
exports.trimQuotedSpaced = trimQuotedSpaced;
function recombineQuoted(aArr) {
    var skipUntil = 0;
    aArr = aArr.map(function (s, index) {
        if (index < skipUntil) {
            debuglog("skipping >" + s + "<");
            return undefined;
        }
        if (/^"/.exec(s)) {
            var i = index;
            while (i < aArr.length && (!/"$/.exec(aArr[i]) || (index === i && s === '"'))) {
                i = i + 1;
            }
            if (i === aArr.length) {
                debuglog("Unterminated quoted string");
                return s;
            }
            else {
                skipUntil = i + 1;
                var res = aArr.slice(index, i + 1).join(" ");
            }
            return res;
        }
        return s;
    }).filter(function (s) {
        return s !== undefined;
    }).map(function (s) {
        return trimQuotedSpaced(s);
    });
    return aArr;
}
exports.recombineQuoted = recombineQuoted;
function isQuoted(sString) {
    return !!/^".*"$/.exec(sString);
}
exports.isQuoted = isQuoted;
function countSpaces(sString) {
    var r = 0;
    for (var i = 0; i < sString.length; ++i) {
        if (sString.charAt(i) === ' ') {
            r = r + 1;
        }
    }
    return r;
}
exports.countSpaces = countSpaces;
var Quotes = /^"([^"]+)"/;
function swallowQuote(str, i) {
    var m = Quotes.exec(str.substring(i));
    if (!m) {
        return { token: undefined,
            nextpos: i
        };
    }
    return {
        token: cleanseStringLeaveDots(m[1]),
        nextpos: (i + m[0].length)
    };
}
exports.swallowQuote = swallowQuote;
var Word2 = /^([.]?([-#A-Z_a-z0-9\/\\\%\$&]([\'.][-#A-Z_a-z0-9\/\\\%\$&])*)+)/;
var Word = /^(([^.,;\'\"]|(\.[^ ,;\'\"]))([^. ,;?!\"']|(\.[^ ,;?!\"'])|(\'[^. ,;?!\"\'])*)+)/;
function swallowWord(str, i) {
    var m = Word.exec(str.substring(i));
    if (!m) {
        return { token: undefined,
            nextpos: i
        };
    }
    return {
        token: m[1],
        nextpos: (i + m[0].length)
    };
}
exports.swallowWord = swallowWord;
function pushToken(res, token) {
    res.tokens.push(token);
    res.fusable[res.tokens.length] = true;
}
/**
 * Returns true iff tokenized represents multiple words, which
 * can potenially be added together;
 */
function isCombinableSplit(tokenized) {
    if (tokenized.tokens.length <= 1) {
        return false;
    }
    for (var i = 1; i < tokenized.tokens.length; ++i) {
        if (!tokenized.fusable[i]) {
            return false;
        }
    }
    return true;
}
exports.isCombinableSplit = isCombinableSplit;
/**
 * return true iff  range @ index is a suitable combinable overlap
 *
 * (typically in the parsed real string)
 * return the targetindex or -1 if impossible
 */
function isCombinableRangeReturnIndex(range, fusable, index) {
    var start = index + range.low;
    var end = index + range.high;
    // example range = -1, 0             index = 1  => start = 0, end = 1, test fusable[1]
    for (var i = start; i < end; ++i) {
        if (!fusable[i + 1]) {
            return -1;
        }
    }
    return start;
}
exports.isCombinableRangeReturnIndex = isCombinableRangeReturnIndex;
function combineTokens(range, index, tokens) {
    var start = index + range.low;
    var end = index + range.high;
    var res = [];
    for (var i = start; i <= end; ++i) {
        res.push(tokens[i]);
    }
    return res.join(" ");
}
exports.combineTokens = combineTokens;
/**
 *
 * Note: this tokenizer recognized .gitigore or .a.b.c as one token
 * trailing . is stripped!
 *@param {string} sString , e.g. "a,b c;d O'Hara and "murph'ys"
 *@return {Array<String>} broken down array, e.g.
 * [["a b c"], ["a", "b c"], ["a b", "c"], ....["a", "b", "c"]]
 */
function tokenizeString(sString, spacesLimit) {
    var res = {
        tokens: [],
        fusable: [false]
    };
    var i = 0;
    var seenSep = false;
    while (i < sString.length) {
        switch (sString.charAt(i)) {
            case '"':
                var { token, nextpos } = swallowQuote(sString, i);
                if (nextpos === i) {
                    // unterminated quote, treat like separator
                    res.fusable[res.tokens.length] = false;
                    seenSep = true;
                    ++i;
                }
                else if (token === "") {
                    res.fusable[res.tokens.length] = false;
                    seenSep = true;
                    i = nextpos;
                }
                else {
                    res.fusable[res.tokens.length] = false;
                    pushToken(res, token);
                    res.fusable[res.tokens.length] = false;
                    i = nextpos;
                }
                break;
            case '\t':
            case '\n':
            case '\r':
            case ' ':
                i++;
                break;
            case ':':
            case ',':
            case '?':
            case '!':
            case ';':
                res.fusable[res.tokens.length] = false;
                seenSep = true;
                ++i;
                break;
            case '.':
            default:
                var { token, nextpos } = swallowWord(sString, i);
                if (token) {
                    pushToken(res, token);
                    i = nextpos;
                }
                else {
                    res.fusable[res.tokens.length] = false;
                    i++;
                }
                break;
        }
    }
    res.fusable[res.tokens.length] = false;
    return res;
}
exports.tokenizeString = tokenizeString;
function makeMatchPattern(str) {
    var tokens = tokenizeString(str);
    var bestlen = 0;
    if (!isCombinableSplit(tokens)) {
        return undefined;
    }
    var best = {
        longestToken: "",
        span: { low: 0, high: 0 }
    };
    if (tokens.tokens.length > 1) {
        tokens.tokens.forEach(function (token, index) {
            var len = token.length;
            if (len > bestlen) {
                bestlen = len;
                best.longestToken = token;
                best.span.low = -index;
            }
        });
        best.span.high = tokens.tokens.length + best.span.low - 1;
        return best;
    }
    return undefined;
}
exports.makeMatchPattern = makeMatchPattern;
/**
 *@param {string} sString , e.g. "a b c"
 *@return {Array<Array<String>>} broken down array, e.g.
 *[["a b c"], ["a", "b c"], ["a b", "c"], ....["a", "b", "c"]]
 */
function breakdownString(sString, spacesLimit) {
    var rString = cleanseString(sString);
    if (spacesLimit === undefined) {
        spacesLimit = -1;
    }
    var u = rString.split(" ");
    u = recombineQuoted(u);
    var k = 0;
    if (u.length === 0) {
        return [[]];
    }
    var w = [[u[0]]];
    while (k < u.length - 1) {
        k = k + 1;
        var r1 = w.map(function (entry) {
            //  debuglog(debuglog.enabled ? JSON.stringify(entry): "-");
            var entry = entry.slice(0);
            //  debuglog(debuglog.enabled ? JSON.stringify(entry): "-");
            var preventry = entry[entry.length - 1];
            // do not combine quoted strings!
            if (preventry === null) {
                /* do nothing */ //return entry;
            }
            else if (isQuoted(u[k]) || isQuoted(preventry)) {
                entry[entry.length - 1] = null;
            }
            else {
                var combined = preventry + " " + u[k];
                if (spacesLimit > 0 && countSpaces(combined) > spacesLimit) {
                    combined = null;
                }
                entry[entry.length - 1] = combined;
            }
            return entry;
        });
        var r2 = w.map(function (entry) {
            //   debuglog(debuglog.enabled ? ("2 >" + JSON.stringify(entry)) : "-");
            var entry = entry.slice(0);
            entry.push(u[k]);
            return entry;
        });
        //debuglog(JSON.stringify(r1));
        //debuglog(JSON.stringify(r2));
        w = r1.concat(r2);
    }
    w = w.filter(function (oMap) {
        return oMap.every(function (sWord) {
            return sWord !== null;
        });
    });
    return w.map(function (oMap) {
        return oMap.map(function (sWord) {
            return trimQuoted(sWord);
        });
    });
}
exports.breakdownString = breakdownString;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQ3JCO0lBQ0QsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBUyxJQUFJO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFTLEtBQUs7WUFDNUIsT0FBTyxLQUFLLEtBQUssSUFBSSxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDSCxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBVSxJQUFJO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEtBQUs7WUFDM0IsT0FBTyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUM7QUFyREQsMENBcURDIiwiZmlsZSI6Im1hdGNoL2JyZWFrZG93bi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAZmlsZVxyXG4gKiBAbW9kdWxlIGpmc2ViLm1nbmxxX21vZGVsLmJyZWFrZG93blxyXG4gKiBAY29weXJpZ2h0IChjKSAyMDE2IEdlcmQgRm9yc3RtYW5uXHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgZGVidWcgZnJvbSAnZGVidWcnO1xyXG5jb25zdCBkZWJ1Z2xvZyA9IGRlYnVnKCdicmVha2Rvd24nKVxyXG5cclxuaW1wb3J0ICogYXMgSU1hdGNoIGZyb20gJy4vaWZtYXRjaCdcclxuXHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuc2VTdHJpbmcoc1N0cmluZzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIHZhciBsZW4gPSAwO1xyXG4gICAgd2hpbGUgKGxlbiAhPT0gc1N0cmluZy5sZW5ndGgpIHtcclxuICAgICAgICBsZW4gPSBzU3RyaW5nLmxlbmd0aDtcclxuICAgICAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHMrL2csICcgJyk7XHJcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXlxccysvLCAnJyk7XHJcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXFxzKyQvLCAnJyk7XHJcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXlssOy5dKy8sICcnKTtcclxuICAgICAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9bLDsuXSskLywgJycpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNTdHJpbmdcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuc2VTdHJpbmdMZWF2ZURvdHMoc1N0cmluZzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIHZhciBsZW4gPSAwO1xyXG4gICAgd2hpbGUgKGxlbiAhPT0gc1N0cmluZy5sZW5ndGgpIHtcclxuICAgICAgICBsZW4gPSBzU3RyaW5nLmxlbmd0aDtcclxuICAgICAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHMrL2csICcgJyk7XHJcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXlxccysvLCAnJyk7XHJcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXFxzKyQvLCAnJyk7XHJcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXlssOyE/XSsvLCAnJyk7XHJcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvWyw7IT9dKyQvLCAnJyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc1N0cmluZ1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuc2VRdW90ZWRTdHJpbmcoc1N0cmluZzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIHZhciBsZW4gPSAwO1xyXG4gICAgd2hpbGUgKGxlbiAhPT0gc1N0cmluZy5sZW5ndGgpIHtcclxuICAgICAgICBsZW4gPSBzU3RyaW5nLmxlbmd0aDtcclxuICAgICAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHNcXHMrL2csICcgJyk7XHJcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXFxzKy9nLCAnICcpO1xyXG4gICAgICAgIHNTdHJpbmcgPSBzU3RyaW5nLnJlcGxhY2UoL15cXHMrLywgJycpO1xyXG4gICAgICAgIHNTdHJpbmcgPSBzU3RyaW5nLnJlcGxhY2UoL1xccyskLywgJycpO1xyXG4gICAgICAgIHNTdHJpbmcgPSBzU3RyaW5nLnJlcGxhY2UoL15bLDsuXSsvLCAnJyk7XHJcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvWyw7Ll0rJC8sICcnKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzU3RyaW5nXHJcbn1cclxuXHJcbmNvbnN0IHJlZ2V4cFJlbW92ZURvdWJsZSA9IG5ldyBSZWdFeHAoL15cXFwiKFxcXCIuKlxcXCIpXFxcIiQvKTtcclxuY29uc3Qgc3RyaXB0YWlsID0gbmV3IFJlZ0V4cCgvXlxcXCIoW15cXFwiXSspXCIkLylcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0cmltUXVvdGVkKHNTdHJpbmc6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICB2YXIgc2tpcFVudGlsID0gMDtcclxuICAgIHZhciBzdHJpcHBlZCA9IHNTdHJpbmc7XHJcbiAgICB2YXIgbSA9IHJlZ2V4cFJlbW92ZURvdWJsZS5leGVjKHNTdHJpbmcpO1xyXG4gICAgd2hpbGUgKG0pIHtcclxuICAgICAgICBzdHJpcHBlZCA9IG1bMV07XHJcbiAgICAgICAgbSA9IHJlZ2V4cFJlbW92ZURvdWJsZS5leGVjKHN0cmlwcGVkKTtcclxuICAgIH1cclxuICAgIGRlYnVnbG9nKFwic3RyaXBwZWQgXCIgKyBzdHJpcHBlZCk7XHJcbiAgICBtID0gc3RyaXB0YWlsLmV4ZWMoc3RyaXBwZWQpO1xyXG4gICAgaWYgKG0pIHtcclxuICAgICAgICByZXR1cm4gbVsxXTtcclxuICAgIH1cclxuICAgIHJldHVybiBjbGVhbnNlU3RyaW5nKHNTdHJpbmcpO1xyXG59XHJcblxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0cmltUXVvdGVkU3BhY2VkKHNTdHJpbmc6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICB2YXIgc2tpcFVudGlsID0gMDtcclxuICAgIHNTdHJpbmcgPSBzU3RyaW5nLnJlcGxhY2UoL15cIlxccysvZywgJ1wiJyk7XHJcbiAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHMrXFxcIiQvZywgJ1wiJyk7XHJcbiAgICByZXR1cm4gc1N0cmluZztcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByZWNvbWJpbmVRdW90ZWQoYUFycjogQXJyYXk8c3RyaW5nPik6IEFycmF5PHN0cmluZz4ge1xyXG4gICAgdmFyIHNraXBVbnRpbCA9IDA7XHJcbiAgICBhQXJyID0gYUFyci5tYXAoZnVuY3Rpb24gKHMsIGluZGV4KSB7XHJcbiAgICAgICAgaWYgKGluZGV4IDwgc2tpcFVudGlsKSB7XHJcbiAgICAgICAgICAgIGRlYnVnbG9nKFwic2tpcHBpbmcgPlwiICsgcyArIFwiPFwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKC9eXCIvLmV4ZWMocykpIHtcclxuICAgICAgICAgICAgdmFyIGkgPSBpbmRleDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBhQXJyLmxlbmd0aCAmJiAoIS9cIiQvLmV4ZWMoYUFycltpXSkgfHwgKGluZGV4ID09PSBpICYmIHMgPT09ICdcIicpKSkge1xyXG4gICAgICAgICAgICAgICAgaSA9IGkgKyAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpID09PSBhQXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJVbnRlcm1pbmF0ZWQgcXVvdGVkIHN0cmluZ1wiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2tpcFVudGlsID0gaSArIDE7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gYUFyci5zbGljZShpbmRleCwgaSArIDEpLmpvaW4oXCIgXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzO1xyXG4gICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChzKSB7XHJcbiAgICAgICAgcmV0dXJuIHMgIT09IHVuZGVmaW5lZDtcclxuICAgIH0pLm1hcChmdW5jdGlvbiAocykge1xyXG4gICAgICAgIHJldHVybiB0cmltUXVvdGVkU3BhY2VkKHMpO1xyXG4gICAgfSlcclxuICAgIHJldHVybiBhQXJyO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNRdW90ZWQoc1N0cmluZykge1xyXG4gICAgcmV0dXJuICEhL15cIi4qXCIkLy5leGVjKHNTdHJpbmcpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY291bnRTcGFjZXMoc1N0cmluZzogc3RyaW5nKSB7XHJcbiAgICB2YXIgciA9IDA7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNTdHJpbmcubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICBpZiAoc1N0cmluZy5jaGFyQXQoaSkgPT09ICcgJykge1xyXG4gICAgICAgICAgICByID0gciArIDE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHI7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVRva2VuaXplZFN0cmluZyB7XHJcbiAgICB0b2tlbnMgOiBzdHJpbmdbXSxcclxuICAgIGZ1c2FibGUgOiBib29sZWFuW107XHJcbiAgICAvL2luZGV4TWFwIDogeyBba2V5Om51bWJlcl0gOiB7IGZ1c2U6IGJvb2xlYW59fTtcclxufVxyXG5cclxudmFyIFF1b3RlcyA9IC9eXCIoW15cIl0rKVwiLztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzd2FsbG93UXVvdGUoc3RyIDogc3RyaW5nLCBpIDogbnVtYmVyKSA6IHsgdG9rZW4gOiBzdHJpbmcsIG5leHRwb3MgOiBudW1iZXJ9IHtcclxuICAgICB2YXIgbSA9IFF1b3Rlcy5leGVjKHN0ci5zdWJzdHJpbmcoaSkpO1xyXG4gICAgIGlmKCFtKSB7XHJcbiAgICAgICAgICByZXR1cm4geyB0b2tlbjogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgbmV4dHBvcyA6IGlcclxuICAgICAgICAgfVxyXG4gICAgIH1cclxuICAgICByZXR1cm4ge1xyXG4gICAgICAgICB0b2tlbiA6IGNsZWFuc2VTdHJpbmdMZWF2ZURvdHMobVsxXSksXHJcbiAgICAgICAgIG5leHRwb3MgOiAoaSArIG1bMF0ubGVuZ3RoKVxyXG4gICAgIH1cclxufVxyXG5cclxudmFyIFdvcmQyID0gL14oWy5dPyhbLSNBLVpfYS16MC05XFwvXFxcXFxcJVxcJCZdKFtcXCcuXVstI0EtWl9hLXowLTlcXC9cXFxcXFwlXFwkJl0pKikrKS87XHJcbnZhciBXb3JkID0gL14oKFteLiw7XFwnXFxcIl18KFxcLlteICw7XFwnXFxcIl0pKShbXi4gLDs/IVxcXCInXXwoXFwuW14gLDs/IVxcXCInXSl8KFxcJ1teLiAsOz8hXFxcIlxcJ10pKikrKS87XHJcbmV4cG9ydCBmdW5jdGlvbiBzd2FsbG93V29yZChzdHIgOiBzdHJpbmcsIGkgOiBudW1iZXIpIDogeyB0b2tlbiA6IHN0cmluZywgbmV4dHBvcyA6IG51bWJlcn0ge1xyXG4gICAgIHZhciBtID0gV29yZC5leGVjKHN0ci5zdWJzdHJpbmcoaSkpO1xyXG4gICAgIGlmKCFtKSB7XHJcbiAgICAgICAgIHJldHVybiB7IHRva2VuOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICBuZXh0cG9zIDogaVxyXG4gICAgICAgICB9XHJcbiAgICAgfVxyXG4gICAgIHJldHVybiB7XHJcbiAgICAgICAgIHRva2VuIDogbVsxXSxcclxuICAgICAgICAgbmV4dHBvcyA6IChpICsgbVswXS5sZW5ndGgpXHJcbiAgICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBwdXNoVG9rZW4ocmVzIDogSVRva2VuaXplZFN0cmluZywgdG9rZW4gOiBzdHJpbmcpIHtcclxuICAgIHJlcy50b2tlbnMucHVzaCh0b2tlbik7XHJcbiAgICByZXMuZnVzYWJsZVtyZXMudG9rZW5zLmxlbmd0aF0gPSB0cnVlO1xyXG59XHJcblxyXG4vKipcclxuICogUmV0dXJucyB0cnVlIGlmZiB0b2tlbml6ZWQgcmVwcmVzZW50cyBtdWx0aXBsZSB3b3Jkcywgd2hpY2hcclxuICogY2FuIHBvdGVuaWFsbHkgYmUgYWRkZWQgdG9nZXRoZXI7XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaXNDb21iaW5hYmxlU3BsaXQodG9rZW5pemVkIDogSVRva2VuaXplZFN0cmluZykge1xyXG4gICBpZih0b2tlbml6ZWQudG9rZW5zLmxlbmd0aCA8PSAxKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgfVxyXG4gICBmb3IodmFyIGkgPSAxOyBpIDwgdG9rZW5pemVkLnRva2Vucy5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgaWYoIXRva2VuaXplZC5mdXNhYmxlW2ldKSB7XHJcbiAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgfVxyXG4gICB9XHJcbiAgIHJldHVybiB0cnVlO1xyXG59XHJcblxyXG4vKipcclxuICogcmV0dXJuIHRydWUgaWZmICByYW5nZSBAIGluZGV4IGlzIGEgc3VpdGFibGUgY29tYmluYWJsZSBvdmVybGFwXHJcbiAqXHJcbiAqICh0eXBpY2FsbHkgaW4gdGhlIHBhcnNlZCByZWFsIHN0cmluZylcclxuICogcmV0dXJuIHRoZSB0YXJnZXRpbmRleCBvciAtMSBpZiBpbXBvc3NpYmxlXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaXNDb21iaW5hYmxlUmFuZ2VSZXR1cm5JbmRleChyYW5nZSA6IElNYXRjaC5JUmFuZ2UgLCBmdXNhYmxlOiBib29sZWFuW10sIGluZGV4OiBudW1iZXIpIHtcclxuICAgIHZhciBzdGFydCA9IGluZGV4ICsgcmFuZ2UubG93O1xyXG4gICAgdmFyIGVuZCA9IGluZGV4ICsgcmFuZ2UuaGlnaDtcclxuICAgIC8vIGV4YW1wbGUgcmFuZ2UgPSAtMSwgMCAgICAgICAgICAgICBpbmRleCA9IDEgID0+IHN0YXJ0ID0gMCwgZW5kID0gMSwgdGVzdCBmdXNhYmxlWzFdXHJcbiAgICBmb3IodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7XHJcbiAgICAgICAgaWYoIWZ1c2FibGVbaSsxXSkge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN0YXJ0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY29tYmluZVRva2VucyhyYW5nZSA6IElNYXRjaC5JUmFuZ2UgLCBpbmRleDogbnVtYmVyLCB0b2tlbnMgOiBzdHJpbmdbXSkge1xyXG4gICAgdmFyIHN0YXJ0ID0gaW5kZXggKyByYW5nZS5sb3c7XHJcbiAgICB2YXIgZW5kID0gaW5kZXggKyByYW5nZS5oaWdoO1xyXG4gICAgdmFyIHJlcyA9IFtdO1xyXG4gICAgZm9yKHZhciBpID0gc3RhcnQ7IGkgPD0gZW5kOyArK2kpIHtcclxuICAgICAgICByZXMucHVzaCh0b2tlbnNbaV0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlcy5qb2luKFwiIFwiKTtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKlxyXG4gKiBOb3RlOiB0aGlzIHRva2VuaXplciByZWNvZ25pemVkIC5naXRpZ29yZSBvciAuYS5iLmMgYXMgb25lIHRva2VuXHJcbiAqIHRyYWlsaW5nIC4gaXMgc3RyaXBwZWQhXHJcbiAqQHBhcmFtIHtzdHJpbmd9IHNTdHJpbmcgLCBlLmcuIFwiYSxiIGM7ZCBPJ0hhcmEgYW5kIFwibXVycGgneXNcIlxyXG4gKkByZXR1cm4ge0FycmF5PFN0cmluZz59IGJyb2tlbiBkb3duIGFycmF5LCBlLmcuXHJcbiAqIFtbXCJhIGIgY1wiXSwgW1wiYVwiLCBcImIgY1wiXSwgW1wiYSBiXCIsIFwiY1wiXSwgLi4uLltcImFcIiwgXCJiXCIsIFwiY1wiXV1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB0b2tlbml6ZVN0cmluZyhzU3RyaW5nOiBzdHJpbmcsIHNwYWNlc0xpbWl0PzogbnVtYmVyKTogSVRva2VuaXplZFN0cmluZyB7XHJcbiAgICB2YXIgcmVzID0ge1xyXG4gICAgICAgIHRva2VuczogW10sXHJcbiAgICAgICAgZnVzYWJsZSA6W2ZhbHNlXVxyXG4gICAgfSBhcyBJVG9rZW5pemVkU3RyaW5nO1xyXG4gICAgdmFyIGkgPSAwO1xyXG4gICAgdmFyIHNlZW5TZXA9IGZhbHNlO1xyXG4gICAgd2hpbGUgKGkgPHNTdHJpbmcubGVuZ3RoICkge1xyXG4gICAgICAgIHN3aXRjaChzU3RyaW5nLmNoYXJBdChpKSkge1xyXG4gICAgICAgICAgICBjYXNlICdcIic6XHJcbiAgICAgICAgICAgICAgICB2YXIgeyB0b2tlbiwgbmV4dHBvcyB9ID0gc3dhbGxvd1F1b3RlKHNTdHJpbmcsaSk7XHJcbiAgICAgICAgICAgICAgICBpZihuZXh0cG9zID09PSBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdW50ZXJtaW5hdGVkIHF1b3RlLCB0cmVhdCBsaWtlIHNlcGFyYXRvclxyXG4gICAgICAgICAgICAgICAgICAgIHJlcy5mdXNhYmxlW3Jlcy50b2tlbnMubGVuZ3RoXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlZW5TZXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICsraTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0b2tlbiA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcy5mdXNhYmxlW3Jlcy50b2tlbnMubGVuZ3RoXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlZW5TZXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGkgPSBuZXh0cG9zO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXMuZnVzYWJsZVtyZXMudG9rZW5zLmxlbmd0aF0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBwdXNoVG9rZW4ocmVzLHRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICByZXMuZnVzYWJsZVtyZXMudG9rZW5zLmxlbmd0aF0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBpID0gbmV4dHBvcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1xcdCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ1xcbic6XHJcbiAgICAgICAgICAgIGNhc2UgJ1xccic6XHJcbiAgICAgICAgICAgIGNhc2UgJyAnOlxyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnOic6XHJcbiAgICAgICAgICAgIGNhc2UgJywnOlxyXG4gICAgICAgICAgICBjYXNlICc/JzpcclxuICAgICAgICAgICAgY2FzZSAnISc6XHJcbiAgICAgICAgICAgIGNhc2UgJzsnOlxyXG4gICAgICAgICAgICAgICAgcmVzLmZ1c2FibGVbcmVzLnRva2Vucy5sZW5ndGhdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBzZWVuU2VwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICsraTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJy4nOlxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdmFyIHt0b2tlbiwgbmV4dHBvc30gPSBzd2FsbG93V29yZChzU3RyaW5nLGkpO1xyXG4gICAgICAgICAgICAgICAgaWYodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBwdXNoVG9rZW4ocmVzLHRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICBpID0gbmV4dHBvcztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZ1c2FibGVbcmVzLnRva2Vucy5sZW5ndGhdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaSsrXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJlcy5mdXNhYmxlW3Jlcy50b2tlbnMubGVuZ3RoXSA9IGZhbHNlO1xyXG4gICAgcmV0dXJuIHJlcztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VNYXRjaFBhdHRlcm4oc3RyOiBzdHJpbmcpIHtcclxuICAgIHZhciB0b2tlbnMgPSB0b2tlbml6ZVN0cmluZyhzdHIpO1xyXG4gICAgdmFyIGJlc3RsZW4gPSAwO1xyXG4gICAgaWYoIWlzQ29tYmluYWJsZVNwbGl0KHRva2VucykpIHtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgdmFyIGJlc3QgPSB7XHJcbiAgICAgICAgbG9uZ2VzdFRva2VuIDogXCJcIixcclxuICAgICAgICBzcGFuOiB7bG93OiAwLCBoaWdoOiAwfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZih0b2tlbnMudG9rZW5zLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICB0b2tlbnMudG9rZW5zLmZvckVhY2goZnVuY3Rpb24odG9rZW4saW5kZXgpIHtcclxuICAgICAgICAgICAgdmFyIGxlbiA9IHRva2VuLmxlbmd0aDtcclxuICAgICAgICAgICAgaWYgKGxlbiA+IGJlc3RsZW4pIHtcclxuICAgICAgICAgICAgICAgIGJlc3RsZW4gPSBsZW47XHJcbiAgICAgICAgICAgICAgICBiZXN0Lmxvbmdlc3RUb2tlbiA9IHRva2VuO1xyXG4gICAgICAgICAgICAgICAgYmVzdC5zcGFuLmxvdyA9IC1pbmRleDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJlc3Quc3Bhbi5oaWdoID0gdG9rZW5zLnRva2Vucy5sZW5ndGggKyBiZXN0LnNwYW4ubG93IC0gMTtcclxuICAgICAgICByZXR1cm4gYmVzdDtcclxuICAgIH1cclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKkBwYXJhbSB7c3RyaW5nfSBzU3RyaW5nICwgZS5nLiBcImEgYiBjXCJcclxuICpAcmV0dXJuIHtBcnJheTxBcnJheTxTdHJpbmc+Pn0gYnJva2VuIGRvd24gYXJyYXksIGUuZy5cclxuICpbW1wiYSBiIGNcIl0sIFtcImFcIiwgXCJiIGNcIl0sIFtcImEgYlwiLCBcImNcIl0sIC4uLi5bXCJhXCIsIFwiYlwiLCBcImNcIl1dXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gYnJlYWtkb3duU3RyaW5nKHNTdHJpbmc6IHN0cmluZywgc3BhY2VzTGltaXQ/OiBudW1iZXIpOiBBcnJheTxBcnJheTxTdHJpbmc+PiB7XHJcbiAgICB2YXIgclN0cmluZyA9IGNsZWFuc2VTdHJpbmcoc1N0cmluZyk7XHJcbiAgICBpZiAoc3BhY2VzTGltaXQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHNwYWNlc0xpbWl0ID0gLTE7XHJcbiAgICB9XHJcbiAgICB2YXIgdSA9IHJTdHJpbmcuc3BsaXQoXCIgXCIpO1xyXG4gICAgdSA9IHJlY29tYmluZVF1b3RlZCh1KTtcclxuICAgIHZhciBrID0gMDtcclxuICAgIGlmICh1Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiBbW11dO1xyXG4gICAgfVxyXG4gICAgdmFyIHcgPSBbW3VbMF1dXTtcclxuICAgIHdoaWxlIChrIDwgdS5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgayA9IGsgKyAxO1xyXG4gICAgICAgIHZhciByMSA9IHcubWFwKGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgICAgLy8gIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyBKU09OLnN0cmluZ2lmeShlbnRyeSk6IFwiLVwiKTtcclxuICAgICAgICAgICAgdmFyIGVudHJ5ID0gZW50cnkuc2xpY2UoMCk7XHJcbiAgICAgICAgICAvLyAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/IEpTT04uc3RyaW5naWZ5KGVudHJ5KTogXCItXCIpO1xyXG4gICAgICAgICAgICB2YXIgcHJldmVudHJ5ID0gZW50cnlbZW50cnkubGVuZ3RoIC0xXTtcclxuICAgICAgICAgICAgLy8gZG8gbm90IGNvbWJpbmUgcXVvdGVkIHN0cmluZ3MhXHJcbiAgICAgICAgICAgIGlmIChwcmV2ZW50cnkgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8qIGRvIG5vdGhpbmcgKi8gLy9yZXR1cm4gZW50cnk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNRdW90ZWQodVtrXSkgfHwgaXNRdW90ZWQocHJldmVudHJ5KSkge1xyXG4gICAgICAgICAgICAgICAgZW50cnlbZW50cnkubGVuZ3RoIC0gMV0gPSBudWxsO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbWJpbmVkID0gcHJldmVudHJ5ICsgXCIgXCIgKyB1W2tdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNwYWNlc0xpbWl0ID4gMCAmJiBjb3VudFNwYWNlcyhjb21iaW5lZCkgPiBzcGFjZXNMaW1pdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbWJpbmVkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVudHJ5W2VudHJ5Lmxlbmd0aCAtIDFdID0gY29tYmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGVudHJ5O1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciByMiA9IHcubWFwKGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgICAvLyAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoXCIyID5cIiArIEpTT04uc3RyaW5naWZ5KGVudHJ5KSkgOiBcIi1cIik7XHJcbiAgICAgICAgICAgIHZhciBlbnRyeSA9IGVudHJ5LnNsaWNlKDApO1xyXG4gICAgICAgICAgICBlbnRyeS5wdXNoKHVba10pO1xyXG4gICAgICAgICAgICByZXR1cm4gZW50cnlcclxuICAgICAgICB9KTtcclxuICAgICAgICAvL2RlYnVnbG9nKEpTT04uc3RyaW5naWZ5KHIxKSk7XHJcbiAgICAgICAgLy9kZWJ1Z2xvZyhKU09OLnN0cmluZ2lmeShyMikpO1xyXG4gICAgICAgIHcgPSByMS5jb25jYXQocjIpO1xyXG4gICAgfVxyXG4gICAgdyA9IHcuZmlsdGVyKGZ1bmN0aW9uKG9NYXApIHtcclxuICAgICAgICByZXR1cm4gb01hcC5ldmVyeShmdW5jdGlvbihzV29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gc1dvcmQgIT09IG51bGw7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB3Lm1hcChmdW5jdGlvbiAob01hcCkge1xyXG4gICAgICAgIHJldHVybiBvTWFwLm1hcChmdW5jdGlvbiAoc1dvcmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRyaW1RdW90ZWQoc1dvcmQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcblxyXG4iXX0=
