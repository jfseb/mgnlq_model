{"version":3,"sources":["/projects/nodejs/botbuilder/mgnlq_model/src/../src/utils/mongo.ts"],"names":[],"mappings":";AAAA;;GAEG;;AAEH,iCAAiC;AACjC,IAAI,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;AAE/B,sBAA6B,QAAa,EAAE,qBAA8B;IAExE,QAAQ,CAAC,OAAO,CAAC,qBAAqB,IAAI,8BAA8B,CAAC,CAAC;IAC1E,IAAI,EAAE,GAAG,QAAQ,CAAC,UAAU,CAAC;IAC7B,IAAI,MAAM,GAAG,IAAI,OAAO,CAAC,UAAU,OAAO,EAAE,MAAM;QAChD,2BAA2B;QAC3B,EAAE,CAAA,CAAC,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,eAAe,CAAC,KAAK,UAAU,CAAC,CAAC,CAAC;YAC/C,EAAE,CAAC,EAAE,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QAC7B,CAAC;QACD,EAAE,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,GAAG;YACjB,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACnB,MAAM,CAAC,GAAG,CAAC,CAAC;QAAA,CAAC,CACd,CAAC;QACF,EAAE,CAAA,CAAC,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,UAAU,CAAC,CAAC,CAAC;YACjD,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QAC/B,CAAC;QACD,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE;YACd,QAAQ,CAAC,eAAe,GAAG,qBAAqB,CAAC,CAAC;YAClD,OAAO,CAAC,EAAE,CAAC,CAAC;QACd,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IACH,MAAM,CAAC,MAAM,CAAC;AAChB,CAAC;AAtBD,oCAsBC;AAED,qBAA4B,QAAc;IACtC,QAAQ,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,OAAO,CAAC,SAAS,IAC9C,OAAO,QAAQ,CAAC,UAAU,CAAC,MAAM,CAAC,SAAS,CAAC,CAC/C,CAAC;AACN,CAAC;AAJD,kCAIC;AAED,oBAA2B,QAAc;IACrC,EAAE,CAAA,CAAC,QAAQ,CAAC,UAAU,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC;QACpC,QAAQ,CAAC,UAAU,EAAE,CAAC;IAC1B,CAAC;AACL,CAAC;AAJD,gCAIC;AAED,yBAAgC,QAAc;IAC1C,WAAW,CAAC,QAAQ,CAAC,CAAC;IACtB,UAAU,CAAC,QAAQ,CAAC,CAAC;AACzB,CAAC;AAHD,0CAGC;AAED,4BAAmC,QAAa;IAC5C,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC,IAAI,CAC5C,CAAC,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,GAAG,CAAC,cAAc,CAAC,CAChD,CAAC;AACN,CAAC;AAJD,gDAIC","file":"utils/mongo.js","sourcesContent":["/**\r\n * Utiltities for mongo\r\n */\r\n\r\nimport * as debugf from 'debugf';\r\nvar debuglog = debugf('model');\r\n\r\nexport function openMongoose(mongoose: any, mongoConnectionString : string) {\r\n\r\n  mongoose.connect(mongoConnectionString || 'mongodb://localhost/nodeunit');\r\n  var db = mongoose.connection;\r\n  var mgopen = new Promise(function (resolve, reject) {\r\n    //db.on.setMaxListeners(0);\r\n    if((typeof db.on.setMaxListeners) === \"function\") {\r\n        db.on.setMaxListeners(0);\r\n    }\r\n    db.on('error', (err) => {\r\n      console.error(err);\r\n      reject(err);}\r\n    );\r\n    if((typeof db.once.setMaxListeners) === \"function\") {\r\n        db.once.setMaxListeners(0);\r\n    }\r\n    db.once('open', function () {\r\n      debuglog('connected to ' + mongoConnectionString);\r\n      resolve(db);\r\n    });\r\n  });\r\n  return mgopen;\r\n}\r\n\r\nexport function clearModels(mongoose : any) {\r\n    mongoose.connection.modelNames().forEach(modelName =>\r\n        delete mongoose.connection.models[modelName]\r\n    );\r\n}\r\n\r\nexport function disconnect(mongoose : any) {\r\n    if(mongoose.connection.readyState > 0) {\r\n        mongoose.disconnect();\r\n    }\r\n}\r\n\r\nexport function disconnectReset(mongoose : any) {\r\n    clearModels(mongoose);\r\n    disconnect(mongoose);\r\n}\r\n\r\nexport function getCollectionNames(mongoose: any) : Promise<String[]> {\r\n    return mongoose.connection.db.collections().then(\r\n        (cols) => cols.map(col => col.collectionName)\r\n    );\r\n}"],"sourceRoot":"ABC"}